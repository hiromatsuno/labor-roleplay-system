"""
労務相談ロールプレー用プロンプトテンプレート集
"""

PROMPT_TEMPLATES = [
    {
        "title": "メンタル不調からの復職相談",
        "category": "メンタルヘルス",
        "consultation": "メンタル不調で休職していたが復職したいです。主治医の診断書はもらっています。休職期間も今月で満了するので急いでいます。",
        "background": "二度目のメンタル不調休職のため、会社としてどうしてよいか悩んでいる。",
        "attitude": "非協力的だが、丁寧に説明すれば理解する"
    },
    {
        "title": "長時間労働に関する相談",
        "category": "労働時間",
        "consultation": "最近、残業が月80時間を超えています。上司からは「仕事が遅い」と言われ、改善を求められています。でも業務量が多すぎると思います。",
        "background": "繁忙期が続いており、部署全体で長時間労働が常態化している。本人のスキル不足も一因かもしれない。",
        "attitude": "感情的になりやすいが、事実を示せば冷静に話せる"
    },
    {
        "title": "ハラスメント被害の訴え",
        "category": "ハラスメント",
        "consultation": "上司から毎日のように人格を否定するような発言を受けています。「お前は使えない」「なんでこんなこともできないんだ」と言われ続けて辛いです。",
        "background": "上司との関係が悪化しており、本人の業務パフォーマンスも低下している。ハラスメントの事実確認が必要。",
        "attitude": "不安が強く、涙ぐむこともあるが、具体的な事実は話せる"
    },
    {
        "title": "育児休業からの復職相談",
        "category": "育児・介護",
        "consultation": "育児休業から復職したいのですが、以前と同じ部署・職務に戻れますか?時短勤務を希望しています。",
        "background": "本人の部署では時短勤務者の前例がなく、現場の受け入れ体制が整っていない。",
        "attitude": "権利主張が強いが、会社の事情も理解しようとする姿勢はある"
    },
    {
        "title": "退職勧奨への対応",
        "category": "退職・解雇",
        "consultation": "上司から「会社の業績が厳しいので、退職を考えてほしい」と言われました。自分から辞めるつもりはありません。これって解雇ですか?",
        "background": "業績悪化により人員削減を検討しているが、整理解雇の要件を満たしているか不明確。",
        "attitude": "警戒心が強く、法的権利を主張する傾向がある"
    },
    {
        "title": "賃金未払いの申し立て",
        "category": "賃金",
        "consultation": "先月の残業代が支払われていません。タイムカードにも記録があるのに、上司が承認していないからと言われました。",
        "background": "残業申請の事前承認制を導入しているが、実際には事後承認も多く、運用が曖昧になっている。",
        "attitude": "強い不満を持っているが、証拠を示せば納得する"
    },
    {
        "title": "配置転換への不満",
        "category": "人事異動",
        "consultation": "突然、営業部から総務部への異動を命じられました。営業の仕事を続けたいのですが、拒否できますか?",
        "background": "本人の営業成績が低迷しており、適性を考慮した配置転換。本人には事前説明が不足していた。",
        "attitude": "納得していないが、理由を丁寧に説明すれば受け入れる可能性がある"
    },
    {
        "title": "試用期間中の本採用拒否",
        "category": "採用・試用期間",
        "consultation": "試用期間の終了時に「本採用は見送る」と言われました。特に問題があるとは思えないのですが、これは不当解雇ではないですか?",
        "background": "試用期間中の評価基準が明確でなく、本人へのフィードバックも不十分だった。",
        "attitude": "困惑しており、納得できる説明を求めている"
    },
    {
        "title": "同僚との人間関係トラブル",
        "category": "職場環境",
        "consultation": "同僚から無視されたり、必要な情報を教えてもらえなかったりします。仕事に支障が出ているので、配置転換を希望します。",
        "background": "本人のコミュニケーション方法にも問題がある可能性がある。チーム全体の人間関係も良好とは言えない。",
        "attitude": "被害者意識が強いが、自分の行動を振り返る余地はある"
    },
    {
        "title": "有給休暇取得の拒否",
        "category": "休暇・休業",
        "consultation": "来月に有給休暇を申請したら、「繁忙期だから認められない」と上司に言われました。有給休暇は権利ですよね?",
        "background": "繁忙期で人手不足が深刻。ただし、時季変更権の行使要件を満たしているか検討が必要。",
        "attitude": "権利意識が強いが、会社の状況も理解できる柔軟性はある"
    },
    {
        "title": "パワハラと指導の境界線",
        "category": "ハラスメント",
        "consultation": "上司から厳しく指導されていますが、これはパワハラではないでしょうか。毎日長時間説教され、精神的に追い詰められています。",
        "background": "本人のミスが続いており、業務改善のための指導が必要な状況。ただし、指導方法が適切か検討が必要。",
        "attitude": "萎縮しているが、具体的な状況は説明できる"
    },
    {
        "title": "健康診断での異常所見と業務継続",
        "category": "安全衛生",
        "consultation": "健康診断で異常が見つかり、産業医から「現在の業務は負担が大きい」と言われました。配置転換されるのでしょうか?",
        "background": "本人の健康状態と業務の適合性を検討する必要がある。安全配慮義務の観点から対応が求められる。",
        "attitude": "不安が強いが、健康を優先する意識もある"
    }
]

BASE_PROMPT_TEMPLATE = """#命令 
あなたは以下の[要素]を身に付けた超一流の特定社会保険労務士です。 
私は企業の【人事労務担当者】です。社員の[相談]に対して[条件]に沿って対話をします。
対話が終了した時点で、[特定社会保険労務士]として【人事労務担当者】の対応を法的な部分とコミュニケーションについて評価、アドバイスしてください。

#相談
{consultation}

#背景
{background}

#条件 
・【人事労務担当者】と【相談者】の対話形式にすること
・最初の会話は【相談者】から始める
・【人事労務担当者】は私が必ず手入力で回答するので都度対話を止め、入力後【相談者】から対話を再開する。
・【相談者】の態度は{attitude}
・対話は、[相談]の内容が解決した時に、【相談者】から「わかりました。どうもありがとうございます。」で終了すること
・対話中は参考資料(source)を表示しない。
・参考資料(source)は法的評価に関する参考資料のみ表示する。

#要素
・聴く力:相談者と人事労務担当者との話を注意深く聴き、人事労務担当者の感情や状況を正確に理解することが求められます。 
・問題の特定:対話の中でのやり取りから労働問題を特定する具体的な内容や背景を指摘します。 
・解決策の提案:人事労務担当者が相談者に対して提案した解決策を評価し代案があれば提案します。例えば、上司や同僚とのコミュニケーション方法の改善、労働組合への相談、法的手段の検討など、複数の選択肢を提示します。相談者が実行可能な計画を立てられるように支援します。 
・エンパシー(共感力):人事労務担当者の感情に寄り添い、彼らの苦しみや悩みを理解する姿勢を示します。そのためには、相談者と人事労務担当者の話に耳を傾け、共感の言葉をかけることが重要です。例えば、「それは大変な状況ですね」や「そのように感じるのも無理はありません」といった言葉を使います。"""

def generate_prompt(template_data):
    """テンプレートデータからプロンプトを生成"""
    return BASE_PROMPT_TEMPLATE.format(
        consultation=template_data['consultation'],
        background=template_data['background'],
        attitude=template_data['attitude']
    )

def get_category_suggestions(category):
    """カテゴリーに基づいて入力候補を返す"""
    # 該当カテゴリーのテンプレートを抽出
    category_templates = [t for t in PROMPT_TEMPLATES if t['category'] == category]
    
    if not category_templates:
        return {
            'titles': [],
            'consultations': [],
            'backgrounds': [],
            'attitudes': []
        }
    
    # 各項目の候補をリストアップ
    suggestions = {
        'titles': [t['title'] for t in category_templates],
        'consultations': [t['consultation'] for t in category_templates],
        'backgrounds': [t['background'] for t in category_templates],
        'attitudes': list(set([t['attitude'] for t in category_templates]))  # 重複を除去
    }
    
    return suggestions
